#!/bin/bash

PRINCE_VERSION="15.3"
echo "-----> Installing PrinceXML $PRINCE_VERSION"
[ -d .downloads ] || mkdir .downloads
(cd .downloads; [ -d "prince-$PRINCE_VERSION-linux-amd64-static" ] ||
  curl -s https://www.princexml.com/download/prince-$PRINCE_VERSION-ubuntu20.04-amd64.tar.gz | tar xzf -)

echo $1 | ./.downloads/prince-$PRINCE_VERSION-ubuntu20.04-amd64/install.sh

cat >$1/bin/prince15 <<EOF
#!/bin/sh

PRINCE_BASE=/usr/local/lib/prince
LICENSE_PATH="$PRINCE_BASE"/license/license.dat
LICENSE_INSTALLED_PATH="$PRINCE_BASE"/license/license_installed

if [ -n "$PRINCE_LICENSE" ]; then
  printenv PRINCE_LICENSE > "$LICENSE_PATH"
  touch "$LICENSE_INSTALLED_PATH"
fi

exec "$PRINCE_BASE/bin/prince" --prefix "$PRINCE_BASE" "$@"
EOF
